<!--adapted from https://bootsnipp.com/snippets/featured/like-hangout-chat-->
<!doctype html>
<html lang="en">
  <head>
    <title>Hello, I'm Eliza</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <style>
      /* add a background image */
      body{
        background-image: url("./images/botback.jpg");  
       
      }
      /* center the text h1 */
      #hiEliza{
        /* margin-left: -80px;
        margin-right: auto; */
        text-align: center;
      }
      /* this effects the textarea box */
      #elizaBox{
        border-style: double;
        border-width: 5px;
        border-radius: 10px;
        width: 450px;
        overflow: auto;
      }  
      /* round the radius of the inputbox */
      #userInputs{
        border-radius: 5px;
      }
      /* put the submit button on top of the inputbox */
      #buttonId{
        margin-left: -65px;
        margin-top: -2px;
        border-radius: 5px;
      }
      /*make modifications to the scrollbar */
      ::-webkit-scrollbar {
         width: 7px;
      }
      /* this makes the under part of the scrollbar smaller */
      ::-webkit-scrollbar-track {
        background: rgb(112, 112, 117);
        border: 4px solid transparent;
        background-clip: content-box;  
      }
      /* this sets the colour of the front part of the scrollbar */
      ::-webkit-scrollbar-thumb {
          background: rgb(208, 208, 223);
      }
    </style>
  </head>
  <body>
    
    <div class="container">
      <h1 id="hiEliza" >Welcome I'm Eliza</h1>
    </div>

    <div class="container" onSubmit="return false;">
      <!-- Adapted from: https://v4-alpha.getbootstrap.com/components/forms/ -->
      <form id="user-input-form">
        <div class="form-group" style="text-align: center">
          
          <label for="output-area">
            
              <textarea class="form-control" name="Eliza" id="elizaBox" rows="20" cols="50" disabled></textarea>
              <!--<label for="user-input">hello</label> --> <!--this puts space between the two textboxes-->
              
              <input type="text" class="form-control" id="userInputs" name="user" aria-describedby="user-input-help" placeholder="Enter input">
              
          </label>
     
          <!--https://stackoverflow.com/questions/7803814/prevent-refresh-of-page-when-button-inside-form-clicked-->
          <button name="data" type="button" id="buttonId" class="btn btn-primary" onclick="return askEliza()">Send</button> 
       
         </div>
      </form>

    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

    <script>

        //https://blog.garstasio.com/you-dont-need-jquery/ajax/
      //https://www.w3schools.com/xml/ajax_xmlhttprequest_send.asp
      //https://www.w3schools.com/xml/ajax_xmlhttprequest_send.asphttps://www.w3schools.com/xml/ajax_xmlhttprequest_send.asp
      function askEliza() {

            //make a new variable which is set to whatever the user enters 
            var userT = document.getElementById("userInputs").value;

            var printUserQuestion ="\n" + "User: " + userT;

            var xhr = new XMLHttpRequest();
            //this prints the question and elizas response 
            xhr.onreadystatechange = function () {
                //Triple equal sign in javascript means equality without type coercion https://stackoverflow.com/questions/11234575/triple-3-equal-signs
                //readystate === 4 means The operation is complete.
                //status 200 denotes a successful request If the server response doesn't
                // explicitly specify a status code, XMLHttpRequest.status will assume the default value of 200.
                if (xhr.readyState === 4 && xhr.status === 200) {
                    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText
                // document.getElementById("elizaBox").value += "\nUser: " + xhr.responseText + "\nEliza: Tell me more about yourself?\n";
                document.getElementById("elizaBox").value += printUserQuestion + xhr.responseText;
                    //this keeps scrolling down with the questions
                    //https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight
                    document.getElementById("elizaBox").scrollTop =  document.getElementById("elizaBox").scrollHeight;
                }
            }
            //open it 
            xhr.open("POST", "/askEliza");
            // xhr.setRequestHeader("Cache-Control", "no-cache");
            // xhr.setRequestHeader("userAskEliza", document.getElementById("userInputs").value);
            xhr.setRequestHeader("userAskEliza", userT);
            //send it 
            xhr.send();

             //clear the user box so whatever the user enters it gets cleared after pressing the submit button
              document.getElementById("userInputs").value = "";  

              //make a variable which gets the length of the user input
              var lenOfText = userT.length;   
              //if anything that is entered less then 1 char will not run the code 
              if(lenOfText < 1) return;
      }

      //Add a Javascript event listener to the keydown event.
      //https://stackoverflow.com/questions/155188/trigger-a-button-click-with-javascript-on-the-enter-key-in-a-text-box
      $("#userInputs").keydown((evt)=>{
          if (evt.keyCode == 13){
              //if user pressed enter then run your askEliza function
            askEliza();
          
          }});

       // greetings for eliza to say to users
      var greetings = [
        "I am Eliza is something troubling you?",
        "How can I help you.",
        "Bonjour I am Eliza What seems to bother you?",
        "Hello I am Eliza Please tell me your problem.",
        "Hola How are you doing today?", 
      ]

      //create a new variable which get the a random greeting 
      var returnGreeting = greetings[Math.floor(Math.random()*greetings.length)];
      //return the random greeting 
      document.getElementById("elizaBox").innerHTML = "Eliza: " + returnGreeting + "\n";     
    </script>

 
  </body>
</html>